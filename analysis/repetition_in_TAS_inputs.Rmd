---
title: "Untitled"
output: html_document
date: "2025-12-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
```

TAS inputs sourced from Happy Lee. CSV generated by `on TAS and ROMs.ipynb`.

```{r}
dat.raw = read_csv("inputs/tas_inputs.csv")
```

```{r}
dat.raw %>%
  group_by(input) %>%
  summarize(n = n()) %>%
  arrange(desc(n))
```


About 82% of adjacent (non-NOOP) frames were identical.

```{r}
immediately.repeating.frames = dat.raw %>%
  mutate(next_input = lead(input)) %>%
  filter(input == next_input) %>%
  filter(input != "........") %>%
  dim()
immediately.repeating.frames = immediately.repeating.frames[1]

immediately.repeating.frames / dim(dat.raw %>% filter(input != "........"))[1]
```
Repeated analysis for an 8-frame window (input equal to next 7 frames).

```{r}
dat.lead = dat.raw

immediately.repeating.frames.8 = dat.lead %>% 
  filter(input != '........') %>%
  mutate(i1 = lead(input, 1),
         i2 = lead(input, 2),
         i3 = lead(input, 3),
         i4 = lead(input, 4),
         i5 = lead(input, 5),
         i6 = lead(input, 6),
         i7 = lead(input, 7),
  ) %>%
  filter(input == i1 & 
           i1 == i2 & 
           i1 == i3 &
           i1 == i4 & 
           i1 == i5 & 
           i1 == i6 &
           i1 == i7) %>%
  dim()

immediately.repeating.frames.8 = immediately.repeating.frames.8[1]

immediately.repeating.frames.8 / dim(dat.raw %>% filter(input != "........"))[1]
```
A visualization of the inputs over time highlighting repetition.

```{r}
dat.raw %>%
  filter(frameNumber > 5000 & frameNumber < 7500) %>%
  mutate(next_input = lead(input)) %>%
  mutate(next_input_match = if_else(input == next_input, TRUE, FALSE)) %>%
  filter(input != '........' & input != 'RLDU.SBA') %>%
  ggplot(aes(x = frameNumber, y = input, color = next_input_match)) +
  geom_point(size = 1, alpha = 0.15)

dat.raw %>%
  mutate(next_input = lead(input)) %>%
  mutate(next_input_match = if_else(input == next_input, TRUE, FALSE)) %>%
  filter(input != '........' & input != 'RLDU.SBA') %>%
  ggplot(aes(x = frameNumber, y = input, color = next_input_match)) +
  geom_point(size = 1, alpha = 0.15)

ggsave("outputs/repetition_in_inputs_TAS.png", dpi = 300, width = 10, height = 6)
```

An attempt at using run-length encoding to similar ends. 

The replication of the prior figure serving as a validation of the approach.


```{r}
lengths = rle(dat.raw$input)$lengths
values = rle(dat.raw$input)$values

dat.rle = tibble(lengths, values)

commonActions = c(".......A", "......B.", "R......A", "R.....B.", "R.....BA")

dat.rle %>%
  filter(values %in% commonActions) %>%
  group_by(values) %>%
  summarize(`Mean length of usage (frames)` = mean(lengths),
            sd = sd(lengths),
            n = n()) %>%
  knitr::kable()

dat.rle %>%
  mutate(value_factor = as.numeric(factor(values))) %>%
  mutate(frame_number = cumsum(lengths)) %>%
  ggplot(aes(x = frame_number, y = value_factor)) +
  geom_point()
```

## Note on generative AI usage

No generative AI was used in the making of this document.
